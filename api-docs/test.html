üìö Guide : Gestion de l'API-REST et du Contrat de Donn√©esCe guide formalise l'architecture de communication entre l'application de bureau (Frontend, docs/app.js) et le serveur Express (Backend, app.js racine).1. Le Principe du Contrat (Swagger)L'objectif principal est que les √©quipes Frontend et Backend travaillent en se basant sur un contrat de donn√©es commun, d√©fini dans un seul fichier :Fichier Central : api-docs/swagger.yamlCe fichier est la source unique de v√©rit√© pour :Les chemins URL exacts (Endpoints) : /api/dashboard/utmi-insights.Les Sch√©mas de Donn√©es (Definitions) : La structure pr√©cise des objets JSON attendus (types, noms de champs, etc.).R√®gle d'or : Si le Frontend a besoin d'une nouvelle donn√©e ou si le Backend modifie une propri√©t√©, le fichier swagger.yaml doit √™tre mis √† jour en premier lieu.2. Le Flux de Donn√©es (Frontend vs. Backend)2.1 C√¥t√© Backend (Express)Le backend g√®re la r√©ception des requ√™tes et leur routage vers les services de donn√©es.Zone de CodeFichierR√¥leMontage des Routesapp.js (racine)Assemble les routeurs sur des chemins sp√©cifiques (ex: /api/hq, /api/dashboard).Logique de Routeroutes/*.jsDoit impl√©menter le contrat d√©fini par Swagger. (Ex: routes/dashboard.js d√©finit /accounting).Points de vigilance : Le fichier app.js (racine) monte certains routeurs sur des chemins non standard, comme app.use('/smartContract/api', dashboardRouter);. Toute nouvelle route doit v√©rifier si elle est mont√©e sur /api/* ou un chemin sp√©cifique.2.2 C√¥t√© Frontend (Module JavaScript)Le Frontend utilise deux m√©canismes pour garantir la r√©silience et la conformit√© :A. Le Mappage de Secours (API_TO_FILE_MAP)La fonction globale window.fetchData (d√©finie dans docs/app.js) permet √† l'application de fonctionner m√™me si le serveur Express est en panne ou en mode d√©veloppement.VariableFichierR√¥leAPI_TO_FILE_MAPdocs/app.jsAssure la correspondance entre l'URL de l'API (ex: /api/hq/finances) et un fichier JSON local (ex: finances.json) utilis√© en mode fallback.window.fetchDatadocs/app.jsD√©clenche fetch(URL) et, en cas d'√©chec (404/r√©seau), charge le fichier correspondant via API_TO_FILE_MAP.B. Le Routage Centralis√© des Modales (handleUserAction)Toutes les interactions utilisateur complexes (clic sur une carte du Dashboard, soumission RIC, etc.) sont g√©r√©es de mani√®re centralis√©e pour √©viter les conflits de fonctions :Fonction de Dispatch : window.handleUserAction(action, value) dans docs/app.js.Modules cibl√©s : Cette fonction d√©l√®gue la t√¢che aux modules sp√©cialis√©s (ex: window.handleDashboardDetailAction dans modalDashboard.js ou window.loadMissionsContent dans missions.js).3. D√©pannage des Conflits API (Quick Fix)Sympt√¥me de l'ErreurCause ProbableSolution (Backend/Routage)Console : GET http://localhost:3000/api/... 404 (Not Found)La route est manquante ou un require a √©chou√© au d√©marrage du serveur.1. V√©rifiez routes/*.js : Assurez-vous que router.get('/chemin') est bien pr√©sent et correspond au Swagger. 2. V√©rifiez les Imports : Assurez-vous qu'aucune ReferenceError (comme dataService non import√©) n'existe dans le routeur, ce qui provoquerait l'√©chec de montage.Console : TypeError: Cannot set properties of null (setting 'innerHTML')Le script JavaScript a √©t√© ex√©cut√© avant que le HTML (missions.html, dashboard.html) ne soit inject√© dans le DOM.V√©rifiez app.js (Frontend) : Assurez-vous que l'appel safeRenderCall(window.load...Content) est bien effectu√© apr√®s le chargement asynchrone du HTML (utilisez loadExternalHTML('fichier.html', target).then(...)).Console : [ACTION INCONNUE]Le switch central de handleUserAction (dans app.js) ne contient pas de cas pour l'action d√©clench√©e.Ajoutez le case 'nom-action' dans window.handleUserAction (dans app.js) et dirigez-le vers le module de rendu correct.üìù Bilan de Conversation pour README.mdCe r√©sum√© peut √™tre ajout√© √† votre README.md pour documenter les d√©veloppements r√©cents.‚úÖ It√©rations R√©cemment Compl√©t√©es (V1.0.3)ModuleT√¢cheDescription de l'Am√©liorationRoutage FrontendRoutage Centralis√©Migration compl√®te de la logique de modale vers window.handleUserAction dans docs/app.js pour √©liminer les conflits de fonctions (ex: telegram-commands, ric-detail).Mission/CVNU (P1)Cr√©ation de Page RobusteCr√©ation des fichiers missions.html et missions.js. Impl√©mentation du chargement asynchrone du contenu HTML dans app.js pour pr√©venir les erreurs de d√©pendance du DOM (TypeError: ... of null).Bot Telegrammanifeste et caisseCommande /manifeste mise √† jour avec le contenu d√©taill√© des objectifs. Commande /caisse impl√©ment√©e avec appel √† l'API du solde de la Caisse de Manifestation.Dashboard Backend (P3)Correction Routage APIR√©solution des erreurs 404 Not Found sur les endpoints du dashboard (notamment /api/dashboard/accounting et /api/hq/*) en v√©rifiant les imports Express dans routes/dashboard.js et routes/hq-data.js.üõ†Ô∏è Prochaines √âtapes Planifi√©esP3 - Finalisation Dashboard : Correction des op√©rations de dashboard.js et modalDashboard.js pour une gestion optimale des 8 endpoints API.P4 - Cartographie : D√©veloppement du nouveau layerMap.js et int√©gration de la logique de modale associ√©e.Le contrat API est d√©sormais formalis√© par swagger.yaml pour assurer la coh√©rence de toutes les structures de donn√©es futures.Souhaitez-vous maintenant que nous reprenions la Phase P3 pour finaliser les op√©rations et le code du Dashboard, en nous concentrant sur les fonctions asynchrones restantes ?