<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIC - Référendum d'Initiative Citoyenne</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
    </style>
</head>
<body class="p-6">

    <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg">
        <h1 class="text-3xl font-bold text-center mb-6 text-indigo-700">Référendum d'Initiative Citoyenne</h1>
        <p class="text-center text-gray-600 mb-8">Déposez une proposition de RIC ou consultez celles en cours de validation.</p>

        <!-- Formulaire de soumission d'un nouveau RIC -->
        <div class="mb-10 p-6 bg-gray-50 rounded-lg shadow-inner border border-gray-200">
            <h2 class="text-2xl font-semibold mb-4 text-indigo-600">Soumettre une proposition de RIC</h2>
            <form id="ric-form" class="space-y-4">
                <div>
                    <label for="question" class="block text-sm font-medium text-gray-700">Question du référendum :</label>
                    <input type="text" id="question" name="question" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2">
                </div>
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700">Description détaillée :</label>
                    <textarea id="description" name="description" rows="4" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2"></textarea>
                </div>
                <div>
                    <label for="deadline" class="block text-sm font-medium text-gray-700">Date limite pour les signatures :</label>
                    <input type="date" id="deadline" name="deadline" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2">
                </div>
                <div>
                    <label for="level" class="block text-sm font-medium text-gray-700">Niveau de l'initiative :</label>
                    <select id="level" name="level" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2">
                        <option value="national">National</option>
                        <option value="regional">Régional</option>
                        <option value="departemental">Départemental</option>
                        <option value="communal">Communal</option>
                    </select>
                </div>
                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Soumettre la proposition
                </button>
            </form>
        </div>

        <!-- Liste des RICs -->
        <div>
            <h2 class="text-2xl font-semibold mb-4 text-indigo-600">Propositions de RIC en cours</h2>
            <div id="ric-list" class="space-y-4">
                <!-- Les RICs seront injectés ici par le JavaScript -->
                <div class="text-center text-gray-500">
                    Chargement des propositions...
                </div>
            </div>
        </div>
    </div>
        <script src="https://petitions.assemblee-nationale.fr/initiatives/i-2743/embed.js"></script>
        <noscript>
            <iframe src="https://petitions.assemblee-nationale.fr/initiatives/i-2743/embed.html" frameborder="0" scrolling="vertical"></iframe>
        </noscript>
    <script>
        // Fonction pour récupérer et afficher la liste des RICs
        async function fetchRics() {
            const ricList = document.getElementById('ric-list');
            ricList.innerHTML = '<div class="text-center text-gray-500">Chargement des propositions...</div>';
            try {
                const response = await fetch('/api/rics');
                const rics = await response.json();
                
                if (rics.length === 0) {
                    ricList.innerHTML = '<div class="text-center text-gray-500">Aucune proposition de RIC pour le moment.</div>';
                } else {
                    ricList.innerHTML = rics.map(ric => `
                        <div class="bg-gray-100 p-4 rounded-lg shadow-sm border border-gray-200">
                            <h3 class="text-lg font-bold text-gray-800">${ric.question}</h3>
                            <p class="text-gray-600">${ric.description}</p>
                            <p class="text-sm text-gray-500 mt-2">
                                Statut: <span class="font-medium text-${ric.status === 'pending' ? 'yellow' : 'green'}-600">${ric.status}</span> | 
                                Niveau: ${ric.level} | 
                                Votes Pour: ${ric.votes_for} | 
                                Votes Contre: ${ric.votes_against}
                                Votes Abstention: ${ric.votes_abstention}
                            </p>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Erreur lors de la récupération des RICs:', error);
                ricList.innerHTML = '<div class="text-center text-red-500">Erreur de connexion au serveur.</div>';
            }
        }

        // Fonction pour gérer la soumission du formulaire
        document.getElementById('ric-form').addEventListener('submit', async (event) => {
            event.preventDefault(); // Empêche le rechargement de la page

            const form = event.target;
            const formData = new FormData(form);
            const ricData = Object.fromEntries(formData.entries());

            try {
                const response = await fetch('/api/rics', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(ricData)
                });

                if (response.ok) {
                    const newRic = await response.json();
                    alert(`Votre proposition "${newRic.question}" a été soumise avec succès et est en attente de validation.`);
                    form.reset(); // Réinitialise le formulaire
                    fetchRics(); // Met à jour la liste pour afficher le nouveau RIC
                } else {
                    const error = await response.json();
                    alert(`Échec de la soumission : ${error.error}`);
                }
            } catch (error) {
                console.error('Erreur lors de l\'envoi du RIC:', error);
                alert('Une erreur est survenue lors de la soumission. Veuillez réessayer.');
            }
        });

        // Charge la liste des RICs au chargement de la page
        window.addEventListener('load', fetchRics);
    </script>
</body>
</html>
